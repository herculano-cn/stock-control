<% content_for :title, "#{@category.name} - Stock Control" %>

<div class="space-y-6">
  <!-- Header -->
  <div class="md:flex md:items-center md:justify-between">
    <div class="min-w-0 flex-1">
      <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
        <%= @category.name %>
      </h2>
    </div>
    <div class="mt-4 flex space-x-3 md:ml-4 md:mt-0">
      <%= link_to 'Voltar', categories_path, class: 'inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50' %>
      <% if policy(@category).edit? %>
        <%= link_to 'Editar', edit_category_path(@category), class: 'inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500' %>
      <% end %>
    </div>
  </div>

  <!-- Category Details -->
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <div class="px-4 py-5 sm:p-6">
      <dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
        <div>
          <dt class="text-sm font-medium text-gray-500">Nome</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @category.name %></dd>
        </div>

        <div>
          <dt class="text-sm font-medium text-gray-500">Status</dt>
          <dd class="mt-1">
            <% if @category.active? %>
              <span class="inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800">Ativo</span>
            <% else %>
              <span class="inline-flex rounded-full bg-red-100 px-2 text-xs font-semibold leading-5 text-red-800">Inativo</span>
            <% end %>
          </dd>
        </div>

        <div class="sm:col-span-2">
          <dt class="text-sm font-medium text-gray-500">Descrição</dt>
          <dd class="mt-1 text-sm text-gray-900">
            <%= @category.description.present? ? @category.description : 'Sem descrição' %>
          </dd>
        </div>

        <div>
          <dt class="text-sm font-medium text-gray-500">Total de Produtos</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @category.products.count %></dd>
        </div>

        <div>
          <dt class="text-sm font-medium text-gray-500">Produtos Ativos</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @category.products.active.count %></dd>
        </div>

        <div>
          <dt class="text-sm font-medium text-gray-500">Criado em</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= l(@category.created_at, format: :long) %></dd>
        </div>

        <div>
          <dt class="text-sm font-medium text-gray-500">Atualizado em</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= l(@category.updated_at, format: :long) %></dd>
        </div>
      </dl>
    </div>
  </div>

  <!-- Products in this Category -->
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <div class="px-4 py-5 sm:p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium leading-6 text-gray-900">Produtos desta Categoria</h3>
        <% if policy(Product).create? %>
          <%= link_to 'Novo Produto', new_product_path(product: { category_id: @category.id }), class: 'text-sm font-medium text-indigo-600 hover:text-indigo-500' %>
        <% end %>
      </div>

      <% if @products.any? %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">SKU</th>
                <th scope="col" class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Nome</th>
                <th scope="col" class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Estoque</th>
                <th scope="col" class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Preço</th>
                <th scope="col" class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Status</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              <% @products.each do |product| %>
                <tr class="hover:bg-gray-50">
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                    <%= product.sku %>
                  </td>
                  <td class="px-3 py-4 text-sm text-gray-900">
                    <%= link_to product.name, product_path(product), class: 'text-indigo-600 hover:text-indigo-900' %>
                  </td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                    <%= product.current_stock %>
                  </td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                    <%= number_to_currency(product.selling_price, unit: 'R$ ', separator: ',', delimiter: '.') %>
                  </td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm">
                    <% if product.active? %>
                      <span class="inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800">Ativo</span>
                    <% else %>
                      <span class="inline-flex rounded-full bg-red-100 px-2 text-xs font-semibold leading-5 text-red-800">Inativo</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <%= render 'shared/pagination', collection: @products %>
      <% else %>
        <p class="text-sm text-gray-500 text-center py-4">Nenhum produto cadastrado nesta categoria.</p>
      <% end %>
    </div>
  </div>
</div>